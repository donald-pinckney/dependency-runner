<h1 id="artifact">Artifact</h1>
<ul>
<li><a href="#artifact">Artifact</a>
<ul>
<li><a href="#building-the-container-image-for-the-artifact">Building
the Container Image for the Artifact</a></li>
<li><a href="#welcome">Welcome</a>
<ul>
<li><a href="#how-to-read-this-document">How to read this
document</a></li>
</ul></li>
<li><a href="#running-the-docker-image">Running the Docker
Image</a></li>
<li><a href="#example-1-checking-that-maxnpm-runs-correctly">Example #1:
Checking that MaxNPM Runs Correctly</a></li>
<li><a
href="#example-2-using-maxnpm-with-different-consistency-criteria">Example
#2: Using MaxNPM With Different Consistency Criteria</a></li>
<li><a
href="#example-3-maxnpm-can-allow-or-disallow-cyclic-solutions">Example
#3: MaxNPM can Allow or Disallow Cyclic Solutions</a></li>
<li><a
href="#example-4-maxnpm-can-find-solutions-when-npm-fails">Example #4:
MaxNPM can Find Solutions when NPM Fails</a></li>
<li><a href="#example-5-maxnpm-can-minimize-oldness">Example #5: MaxNPM
can Minimize Oldness</a></li>
<li><a
href="#example-6-maxnpm-can-minimize-number-of-dependencies">Example #6:
MaxNPM can Minimize Number of Dependencies</a></li>
<li><a
href="#example-7-maxnpm-can-minimize-number-of-vulnerable-dependencies">Example
#7: MaxNPM can Minimize Number of Vulnerable Dependencies</a></li>
<li><a href="#running-the-experiments-of-the-evaluation-section">Running
the Experiments of the Evaluation Section</a></li>
</ul></li>
</ul>
<h2 id="building-the-container-image-for-the-artifact">Building the
Container Image for the Artifact</h2>
<p>To build the container image:</p>
<ol type="1">
<li>Download Docker engine from https://docs.docker.com/engine/install/
or your package manager of choice</li>
<li>Locate the Dockerfile in this directory (<code>artifact</code>
directory in the PacSolve repository)</li>
<li>Run <code>docker build -t pacsolve-artifact .</code> in the command
line while being in the same directory as the Dockerfile</li>
</ol>
<h2 id="welcome">Welcome</h2>
<p>Welcome to the virtual machine which we have prepared to illustrate
the functionality of PacSolve and MaxNPM.</p>
<p><strong>General layout of the artifact</strong>: All of the code is
in the directory <code>/home/artifact</code>. Within that directory, the
following sub-directories are of interest:</p>
<ul>
<li><code>pacsolve/arborist/</code> and <code>pacsolve/npm/</code>
contain the source code of our fork of NPM, which have been modified to
solve dependencies by invoking PacSolve.</li>
<li><code>pacsolve/RosetteSolver/</code> contains the source code of
PacSolve, which implements a flexible dependency solving backend via
translation to Max-SMT by using Rosette.</li>
</ul>
<h3 id="how-to-read-this-document">How to read this document</h3>
<p>The rest of this document will proceed by following the series of
examples contained in <code>artifact/</code>, to gain an understanding
of how MaxNPM functions on examples. <strong>Every single
command</strong> which you are required to run will be annotated with a
Step Number, some shell commands, and a possible box describing the
expected command results, like so:</p>
<p><strong>Step 0:</strong></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;example&quot;</span></span></code></pre></div>
<blockquote>
<p>Expected result: should print ‘example’ to the terminal</p>
</blockquote>
<p>Finally, the very end of this document explains the steps necessary
to re-run the full experiments conducted in the evaluation section.
However, running these experiments takes quite a long compute time
(several days).</p>
<h2 id="running-the-docker-image">Running the Docker Image</h2>
<p><strong>Step 1:</strong> To run the image, type this command in your
command line:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--entrypoint</span> bash pacsolve-artifact</span></code></pre></div>
<p>From here on out, all commands will be run inside this shell.</p>
<h2 id="example-1-checking-that-maxnpm-runs-correctly">Example #1:
Checking that MaxNPM Runs Correctly</h2>
<p>As a first example, we solve a trivial dependency example to verify
that everything runs as expected, and to introduce the basic concepts
for how to run MaxNPM and how to compare outputs with vanilla NPM.</p>
<p>The scenario of the first example is described in this table:</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Dep 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root context</td>
<td><code>a: *</code></td>
</tr>
<tr class="even">
<td><code>a@1.0.0</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>meaning that the root solving context has a single dependency on any
version of <code>a</code>, and <code>a</code> version 1.0.0 (the only
version) has no dependencies. For your reference, the directories inside
<code>ex1_maxnpm_runs/</code> encode this scenario with NPM packages
which have already been uploaded to <code>npmjs.com</code>. As an
example, package <code>a</code> version <code>1.0.0</code> is described
by <code>ex1_maxnpm_runs/a@1.0.0/package.json</code>, and has already
been published as <code>@minnpm-artifact-examples/ex1-a</code> (<a
href="https://www.npmjs.com/package/@minnpm-artifact-examples/ex1-a">link</a>).</p>
<p>There is only one possible solution for this example, which is:</p>
<figure>
<img src="images/ex1.png" alt="root context depends on a@1.0.0" />
<figcaption aria-hidden="true">root context depends on
a@1.0.0</figcaption>
</figure>
<p>Let’s check that both vanilla NPM and MaxNPM find this solution.</p>
<p><strong>Step 2:</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex1_maxnpm_runs/root_context</span></code></pre></div>
<p><strong>Step 3:</strong></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages with vanilla NPM</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the resulting lockfile, then clear solve results</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> node_modules/.package-lock.json result-vanilla.json<span class="kw">;</span> <span class="fu">rm</span> <span class="at">-rf</span> node_modules package-lock.json</span></code></pre></div>
<blockquote>
<p>Expected result: the install command should succeed. If not, please
verify / fix internet connectivity within the container.</p>
</blockquote>
<p><strong>Step 4:</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages with MaxNPM</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">maxnpm</span> install <span class="at">--maxnpm</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or (--maxnpm and --rosette are equivalent as of now)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">maxnpm</span> install <span class="at">--rosette</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the resulting lockfile, then clear solve results</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> node_modules/.package-lock.json result-naxnpm.json<span class="kw">;</span> <span class="fu">rm</span> <span class="at">-rf</span> node_modules package-lock.json</span></code></pre></div>
<blockquote>
<p>Expected result: the install command should succeed.</p>
</blockquote>
<p><strong>Step 5:</strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at both results</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-n</span> +1 result-<span class="pp">*</span>.json</span></code></pre></div>
<blockquote>
<p>Expected result: both result files should describe the solution graph
drawn above. Specifically, the <code>packages</code> field contains a
dictionary listing all solved dependencies. There should be one solved
dependency: <code>node_modules/@minnpm-artifact-examples/ex1-a</code>,
version <code>1.0.0</code>. Note that one file may lack tarball URLs,
but this does not affect functionality.</p>
</blockquote>
<p>Running both the <code>npm</code>, <code>cp</code> and
<code>rm</code> and <code>tail</code> commands each time is tedious, so
we have included a script to automate this. Let’s repeat the above
example by using the <code>compare_solvers</code> script:</p>
<p><strong>Step 6:</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">compare_solvers</span> vanilla maxnpm=<span class="st">&#39;--maxnpm&#39;</span></span></code></pre></div>
<blockquote>
<p>Expected result: both install commands should succeed, and
<code>result-vanilla.json</code> and <code>result-maxnpm.json</code>
should be produced just as when done manually.</p>
</blockquote>
<p><strong>Step 7:</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2
id="example-2-using-maxnpm-with-different-consistency-criteria">Example
#2: Using MaxNPM With Different Consistency Criteria</h2>
<p>We now demonstrate that MaxNPM can be configured to use 3 different
consistency policies (NPM, Cargo, and PIP-style).</p>
<p>The scenario to solve in this example is precisely that of Figure 1
in the paper, which is summarized in the following table:</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Dep 1</th>
<th>Dep 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root context</td>
<td><code>debug: *</code></td>
<td><code>ms: &lt; 2.1.2</code></td>
</tr>
<tr class="even">
<td><code>debug@4.3.4</code></td>
<td><code>ms: 2.1.2</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>ms@1.0.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>ms@2.1.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>ms@2.1.2</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>There is a potential conflict because <code>root context</code> and
<code>debug@4.3.4</code> cannot agree on a version of <code>ms</code>.
MaxNPM exposes 3 different polices for conflicts:</p>
<ol type="1">
<li><p>(NPM’s policy): Freely allow co-installation of multiple
versions, yielding this solution graph:</p>
<figure>
<img src="images/ex2_npm.png"
alt="root context depends on debug@4.3.4 and ms@2.1.0, debug@4.3.4 depends on ms@2.1.0" />
<figcaption aria-hidden="true">root context depends on debug@4.3.4 and
ms@2.1.0, debug@4.3.4 depends on ms@2.1.0</figcaption>
</figure></li>
<li><p>(Cargo’s policy): Allow co-installation of versions which are
<strong>not</strong> SemVer compatible. In this case,
<code>ms@2.1.2</code> can be co-installed with <code>ms@1.0.0</code> but
<strong>not</strong> <code>ms@2.1.0</code>, yielding this solution
graph:</p>
<figure>
<img src="images/ex2_cargo.png"
alt="root context depends on debug@4.3.4 and ms@2.1.0, debug@4.3.4 depends on ms@1.0.0" />
<figcaption aria-hidden="true">root context depends on debug@4.3.4 and
ms@2.1.0, debug@4.3.4 depends on ms@1.0.0</figcaption>
</figure></li>
<li><p>(PIP’s policy): Disallow co-installation of multiple versions,
yielding unsatisfiable constraints in this example.</p></li>
</ol>
<p>Let’s now observe MaxNPM performing these solves in practice.</p>
<p><strong>Step 8:</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex2_consistency_criteria/root_context</span></code></pre></div>
<p><strong>Step 9:</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">compare_solvers</span> <span class="dt">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    vanilla <span class="dt">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    maxnpm-npm=<span class="st">&#39;--maxnpm --consistency npm&#39;</span> <span class="dt">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    maxnpm-cargo=<span class="st">&#39;--maxnpm --consistency cargo&#39;</span> <span class="dt">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    maxnpm-pip=<span class="st">&#39;--maxnpm --consistency pip&#39;</span></span></code></pre></div>
<blockquote>
<p>Expected result: All solves except <code>maxnpm-pip</code> should
succeed. The <code>result-vanilla.json</code> and
<code>result-maxnpm-npm.json</code> files should both contain the
solution graph of policy (1) above, and <code>result-cargo.json</code>
should contain the solution graph of policy (2) above. When reading the
result files, the solution graph node for <code>ms</code> contained
inside <code>debug</code> is notated by its key being a subdirectory of
<code>debug</code>.</p>
</blockquote>
<p><strong>Step 10:</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2 id="example-3-maxnpm-can-allow-or-disallow-cyclic-solutions">Example
#3: MaxNPM can Allow or Disallow Cyclic Solutions</h2>
<p>On Page 13, <em>Incompleteness of Cargo</em> presents an example
demonstrating a dimension in which Cargo is not a complete solver,
because of its non-backtracking behavior when enforcing acyclic
solutions. We present that example here (slightly simplified) to show
how MaxNPM (backed by PacSolve) can be configured to either allow or
disallow cycles without sacrificing completeness.</p>
<p>The scenario to solve is:</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Dep 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root context</td>
<td><code>a: *</code></td>
</tr>
<tr class="even">
<td><code>a@1.0.0</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>a@2.0.0</code></td>
<td><code>b: *</code></td>
</tr>
<tr class="even">
<td><code>b@1.0.0</code></td>
<td><code>a: 2.0.0</code></td>
</tr>
</tbody>
</table>
<p>There are exactly 2 solution graphs which satisfy this example, one
with cycles and one without:</p>
<figure>
<img src="images/ex3_yes_cycle.png"
alt="root context depends on a@2.0.0, a@2.0.0 depends on b@1.0.0, b@1.0.0 depends on a@2.0.0" />
<figcaption aria-hidden="true">root context depends on a@2.0.0, a@2.0.0
depends on b@1.0.0, b@1.0.0 depends on a@2.0.0</figcaption>
</figure>
<figure>
<img src="images/ex3_no_cycle.png"
alt="root context depends on a@1.0.0" />
<figcaption aria-hidden="true">root context depends on
a@1.0.0</figcaption>
</figure>
<p>Let’s try solving it both ways.</p>
<p><strong>Step 11:</strong></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex3_cycles/root_context</span></code></pre></div>
<p><strong>Step 12:</strong></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MaxNPM allows cycles by default, the flag</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --disallow-cycles tells MaxNPM to only look for acyclic solutions.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">compare_solvers</span> <span class="dt">\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    maxnpm=<span class="st">&#39;--maxnpm&#39;</span> <span class="dt">\</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    maxnpm-acyclic=<span class="st">&#39;--maxnpm --disallow-cycles&#39;</span></span></code></pre></div>
<blockquote>
<p>Expected result: All solves should succeed. The
<code>result-maxnpm.json</code> file should contain the cyclic solution
graph. The cycle is notated by <code>b@1.0.0</code> having as a child a
special link type (<code>"link" : true</code>), with a
<code>resolved</code> field indicating the link destination. In this
example the link destination is <code>a@2.0.0</code>. The
<code>result-maxnpm-acyclic.json</code> file should contain the acyclic
solution graph.</p>
</blockquote>
<p>Note that MaxNPM prefers to choose the cyclic solution graph because
it produces newer versions of dependencies.</p>
<p><strong>Step 13:</strong></p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2 id="example-4-maxnpm-can-find-solutions-when-npm-fails">Example #4:
MaxNPM can Find Solutions when NPM Fails</h2>
<p>On Pages 12-13, <em>Incompleteness of NPM</em> presents an example
demonstrating a dimension in which NPM is not a complete solver, because
it does not perform backtracking. When encountering an unsatisfiable
constraint, NPM fails, whereas MaxNPM can still find a satisfying
solution graph. For this example the scenario to solve is:</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Dep 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root context</td>
<td><code>a: *</code></td>
</tr>
<tr class="even">
<td><code>a@1.0.0</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>a@2.0.0</code></td>
<td><code>b: 9.9.9</code></td>
</tr>
<tr class="even">
<td><code>b@1.0.0</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>There is no solution graph in which the root context depends on
<code>a@2.0.0</code>. The only solution graph is:</p>
<figure>
<img src="images/ex4.png" alt="root context depends on a@1.0.0" />
<figcaption aria-hidden="true">root context depends on
a@1.0.0</figcaption>
</figure>
<p>Let’s try solving with both vanilla NPM and MaxNPM.</p>
<p><strong>Step 14:</strong></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex4_npm_incomplete/root_context</span></code></pre></div>
<p><strong>Step 15:</strong></p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">compare_solvers</span> <span class="dt">\</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    vanilla <span class="dt">\</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    maxnpm=<span class="st">&#39;--maxnpm&#39;</span></span></code></pre></div>
<blockquote>
<p>Expected result: The MaxNPM solve should succeed, and the NPM solve
should fail. The <code>result-maxnpm.json</code> file should contain the
solution graph drawn above.</p>
</blockquote>
<p><strong>Step 16:</strong></p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2 id="example-5-maxnpm-can-minimize-oldness">Example #5: MaxNPM can
Minimize Oldness</h2>
<p>MaxNPM finds globally optimal solution graphs, for some chosen
minimization criteria. To see this in action, consider this scenario to
solve:</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Dep 1</th>
<th>Dep 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root context</td>
<td><code>a: *</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>a@1.0.0</code></td>
<td><code>b: 2.0.0</code></td>
<td><code>c: 2.0.0</code></td>
</tr>
<tr class="odd">
<td><code>a@2.0.0</code></td>
<td><code>b: 1.0.0</code></td>
<td><code>c: 1.0.0</code></td>
</tr>
<tr class="even">
<td><code>b@1.0.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>b@2.0.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>c@1.0.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>c@2.0.0</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>There are exactly 2 possible solution graphs, corresponding to which
version of <code>a</code>:</p>
<figure>
<img src="images/ex5_a100.png"
alt="root context depends on a@1.0.0, a@1.0.0 depends on b@2.0.0 and c@2.0.0" />
<figcaption aria-hidden="true">root context depends on a@1.0.0, a@1.0.0
depends on b@2.0.0 and c@2.0.0</figcaption>
</figure>
<figure>
<img src="images/ex5_a200.png"
alt="root context depends on a@2.0.0, a@2.0.0 depends on b@1.0.0 and c@1.0.0" />
<figcaption aria-hidden="true">root context depends on a@2.0.0, a@2.0.0
depends on b@1.0.0 and c@1.0.0</figcaption>
</figure>
<p>The first solution graph has an old version of <code>a</code>, but
new versions of <code>b</code> and <code>c</code>. The second graph has
a new version of <code>a</code>, but old versions of <code>b</code> and
<code>c</code>. Let’s try using MaxNPM to minimize the total oldness in
the solution.</p>
<p><strong>Step 17:</strong></p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex5_min_oldness/root_context</span></code></pre></div>
<p><strong>Step 18:</strong></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By default, MaxNPM minimizes the total oldness in the solution, so</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we don&#39;t need to specify any additional flags.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">compare_solvers</span> <span class="dt">\</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    vanilla <span class="dt">\</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    maxnpm=<span class="st">&#39;--maxnpm&#39;</span></span></code></pre></div>
<blockquote>
<p>Expected result: both solves should succeed. The
<code>result-vanilla.json</code> file should contain the solution graph
with (<code>a@2.0.0</code>; <code>b@1.0.0</code>; <code>c@1.0.0</code>),
and the <code>result-maxnpm.json</code> file should contain the solution
graph with (<code>a@1.0.0</code>; <code>b@2.0.0</code>;
<code>c@2.0.0</code>)</p>
</blockquote>
<p><strong>Step 19:</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2 id="example-6-maxnpm-can-minimize-number-of-dependencies">Example
#6: MaxNPM can Minimize Number of Dependencies</h2>
<p>MaxNPM can also be configured to minimize the total number of
dependencies in the solution graph. Consider solving this situation:</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Dep 1</th>
<th>Dep 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>root context</td>
<td><code>a: *</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>a@1.0.0</code></td>
<td><code>b: *</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>a@2.0.0</code></td>
<td><code>b: *</code></td>
<td><code>c: *</code></td>
</tr>
<tr class="even">
<td><code>b@1.0.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>b@2.0.0</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>c@1.0.0</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>There are exactly 4 possible solution graphs, corresponding to which
versions of <code>a</code> and <code>b</code>:</p>
<figure>
<img src="images/ex6_a100_b100.png"
alt="root context depends on a@1.0.0, a@1.0.0 depends on b@1.0.0" />
<figcaption aria-hidden="true">root context depends on a@1.0.0, a@1.0.0
depends on b@1.0.0</figcaption>
</figure>
<figure>
<img src="images/ex6_a100_b200.png"
alt="root context depends on a@1.0.0, a@1.0.0 depends on b@2.0.0" />
<figcaption aria-hidden="true">root context depends on a@1.0.0, a@1.0.0
depends on b@2.0.0</figcaption>
</figure>
<figure>
<img src="images/ex6_a200_b100.png"
alt="root context depends on a@2.0.0, a@2.0.0 depends on b@1.0.0 and c@1.0.0" />
<figcaption aria-hidden="true">root context depends on a@2.0.0, a@2.0.0
depends on b@1.0.0 and c@1.0.0</figcaption>
</figure>
<figure>
<img src="images/ex6_a200_b200.png"
alt="root context depends on a@2.0.0, a@2.0.0 depends on b@2.0.0 and c@1.0.0" />
<figcaption aria-hidden="true">root context depends on a@2.0.0, a@2.0.0
depends on b@2.0.0 and c@1.0.0</figcaption>
</figure>
<p>The first two solution graphs have an old version of <code>a</code>,
but one fewer dependency. By default MaxNPM prefers to choose the newer
version of <code>a</code>, but we can configure its minimization
criteria to prioritize getting fewer dependencies.</p>
<p><strong>Step 20:</strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex6_min_num_deps/root_context</span></code></pre></div>
<p><strong>Step 21:</strong></p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The default value for --minimize if unspecified is:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --minimize min_oldness,min_num_deps</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">compare_solvers</span> <span class="dt">\</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    vanilla <span class="dt">\</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    maxnpm-min-oldness-then-num-deps=<span class="st">&#39;--maxnpm&#39;</span> <span class="dt">\</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    maxnpm-min-num-deps-then-oldness=<span class="st">&#39;--maxnpm --minimize min_num_deps,min_oldness&#39;</span></span></code></pre></div>
<blockquote>
<p>Expected result: all solves should succeed. The
<code>result-vanilla.json</code> and
<code>result-maxnpm-min-oldness-then-num-deps.json</code> files and
should contain the solution graph with (<code>a@2.0.0</code>;
<code>b@2.0.0</code>; <code>c@1.0.0</code>), and the
<code>result-maxnpm-min-num-deps-then-oldness.json</code> file should
contain the solution graph with (<code>a@1.0.0</code>;
<code>b@2.0.0</code>)</p>
</blockquote>
<p>Note that because we minimize <code>min_oldness</code> at second
priority, we get a solution with <code>b@2.0.0</code> rather than
<code>b@1.0.0</code>, as that does not affect graph size.</p>
<p><strong>Step 22:</strong></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2
id="example-7-maxnpm-can-minimize-number-of-vulnerable-dependencies">Example
#7: MaxNPM can Minimize Number of Vulnerable Dependencies</h2>
<p>MaxNPM can be configured to minimize the total sum <a
href="https://nvd.nist.gov/vuln-metrics/cvss">CVSS</a> score of all
dependencies in a solution graph.</p>
<p>We take a version range of jQuery as an example:
<code>"jquery": "jquery": "^1.8.3 || ^2.0"</code><br />
and we take a list of vulnerable version ranges with their CVSS
“badness” score (taken from the <a
href="https://github.com/advisories">GitHub Advisory Database</a>): |
Range | CVSS | | ———— | —— | | <code>&gt;= 1.7.1 &lt;= 1.8.3</code> |
<code>7.95</code> | | <code>&lt; 1.9.0</code> | <code>6.1</code> | |
<code>&gt;= 1.2 &lt; 3.5.0</code> | <code>6.9</code> | |
<code>&gt;= 1.0.3 &lt; 3.5.0</code> | <code>6.9</code> | |
<code>&lt; 3.4.0</code> | <code>6.1</code> | |
<code>&gt; 2.1.0, &lt; 3.0.0</code> | <code>7.5</code> | |
<code>&lt; 3.0.0</code> | <code>6.1</code> |</p>
<p>Given these ranges, the optimal solution in the required version
range of <code>^1.8.3 || ^2.0</code> is some version in the range of
<code>&gt; 1.9.0 &lt; 2.1.0</code>, as that would give us with a total
CVSS score of <code>26.0</code>.<br />
Vanilla npm would choose the latest version of the package in that range
(<code>2.2.4</code>), and <code>npm audit</code> will show
<strong>1</strong> non-fixable (unless <code>--force</code> is enabled)
high severity vulnerability, despite having 5 vulnerabilities at a total
CVSS score of <code>33.5</code>.<br />
Meanwhile, MaxNPM is able to choose the optimal solution with the
<code>min_cve</code> or <code>min_cve,min_oldness</code> minimization
objective, and give us a total CVSS score of <code>26.0</code>.</p>
<p><strong>Step 23</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pushd</span> ex7_min_cve/</span></code></pre></div>
<p><strong>Step 24</strong></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we install with vanilla npm</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># save the lockfile</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> node_modules/.package-lock.json result-vanilla.json<span class="kw">;</span> <span class="fu">rm</span> <span class="at">-rf</span> node_modules package-lock.json</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># then we install with maxnpm minimizing only min_cve</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">maxnpm</span> install <span class="at">--maxnpm</span> <span class="at">--minimize</span> min_cve</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># save the lockfile</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> node_modules/.package-lock.json result-min_cve.json<span class="kw">;</span> <span class="fu">rm</span> <span class="at">-rf</span> node_modules package-lock.json</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># finally, we install the package with both min_cve and min_oldness objectives</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="ex">maxnpm</span> install <span class="at">--maxnpm</span> <span class="at">--minimize</span> min_cve,min_oldness</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># save the lockfile</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> node_modules/.package-lock.json result-min_cve-min_oldness.json<span class="kw">;</span> <span class="fu">rm</span> <span class="at">-rf</span> node_modules package-lock.json</span></code></pre></div>
<p><strong>Step 25</strong></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now we check and compare the results for each installation</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">get_cvss</span> result-vanilla.json</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">get_cvss</span> result-min_cve.json</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">get_cvss</span> result-min_cve-min_oldness.json</span></code></pre></div>
<p><strong>Step 26</strong></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">popd</span></span></code></pre></div>
<h2 id="running-the-experiments-of-the-evaluation-section">Running the
Experiments of the Evaluation Section</h2>
<p>Finally, this container can also be used to reproduce the
experimental results of evaluation section of the paper.</p>
<p><strong>Note: reproducing the experimental results within this
container will take 3-10 days of compute. Proceed only if you
wish!</strong></p>
<p>We will not perfectly reproduce the results, particularly performance
results, due to limited time and compute resources and variation from
the machines on which we ran the reported experiments.</p>
<p>First, we clear any existing experimental data. This deletes all the
directories <code>/home/artifact/experiment-dir*/</code>:</p>
<p><strong>Step 27:</strong></p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear any existing experiment data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">delete_experiment</span></span></code></pre></div>
<p>Now, we can run the main experiment, which will run NPM and MaxNPM
(in many configurations) on 1000 packages. Note that the paper used a
timeout of 600 seconds, but in order to get results sooner we decrease
the timeout to 60 seconds:</p>
<p><strong>Step 28:</strong></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes about 2-3 days</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">run_experiment</span> 60 top1000_comparison</span></code></pre></div>
<p>To verify that the experiments ran, you can check that the directory
<code>/home/artifact/experiment-dir</code> exists, and poke at the
contents. If you believe that some of the experiments may have failed
spuriously (for example due to a network disconnection), you can simply
re-run <code>run_experiment 60</code>, and it will re-run only
previously failed ones.</p>
<p>Next, we can run the performance measurement experiment:</p>
<p><strong>Step 29:</strong></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes about 4 hours</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">run_perf</span> top1000_comparison</span></code></pre></div>
<p>To verify that the performance experiments ran, you can check that
the directory <code>/home/artifact/experiment-dir-perf</code> exists and
contains 2 <code>.csv</code> files.</p>
<p>Now that all experiments have finished running, we perform some
pre-analysis data collection:</p>
<p><strong>Step 30:</strong></p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes about 30-60 minutes</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">prepare_analysis</span> top1000_comparison</span></code></pre></div>
<p>To verify that this step succeeded, you can check that the following
files / directories exist:</p>
<ul>
<li><code>/home/artifact/experiment-dir/results.csv</code></li>
<li><code>/home/artifact/experiment-dir-oldness/*.csv</code></li>
<li><code>/home/artifact/experiment-dir-sizes/*.tsv</code></li>
</ul>
<p>Finally, we can produce the figures and tables:</p>
<p><strong>Step 31:</strong></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is very fast</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">save_analysis</span> top1000_comparison</span></code></pre></div>
<p>Then, the following directories contain the topline numbers, plots,
and tables corresponding to what is reported in the paper:</p>
<ul>
<li><code>/home/artifact/number-results/</code></li>
<li><code>/home/artifact/plots/</code></li>
<li><code>/home/artifact/tables/</code></li>
</ul>
<p>Note that some differences are expected: 1) some results, in
particular the performance results and the number of timeouts will be
different, as explained above. 2) the tables are formatted a bit
differently, with some re-arranged out commented-out rows in the
verbatim paper tables.</p>
<p>To run the vulnerability analysis evaluation, re-run the commands in
this section but substitute <code>top1000_comparison</code> with
<code>vuln_tarballs</code></p>
